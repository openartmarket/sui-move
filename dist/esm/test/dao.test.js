import assert from "assert";
import { mintArtwork } from "../src/artwork";
import { mintArtworkShard } from "../src/artwork_shard";
import { ADMIN_CAP_ID, ADMIN_PHRASE, PACKAGE_ID, USER1_PHRASE, USER2_PHRASE, USER3_PHRASE, } from "../src/config";
import { endRequestVoting } from "../src/end_request_voting";
import { vote } from "../src/vote";
import { createVoteRequest } from "../src/vote_request";
const artworkOptions = {
    signerPhrase: ADMIN_PHRASE,
    packageId: PACKAGE_ID,
    adminCapId: ADMIN_CAP_ID,
    totalSupply: 500,
    sharePrice: 10,
    multiplier: 100,
    name: "Mona Lisa",
    artist: "Leonardo da Vinci",
    creationDate: "1685548680595",
    description: "Choconta painting",
    currency: "NOK",
    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg/800px-Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg",
};
describe("DAO Voting structure", () => {
    let artworkId;
    beforeEach(async () => {
        artworkId = await mintArtwork(artworkOptions);
        await mintArtworkShard({
            artworkId,
            signerPhrase: ADMIN_PHRASE,
            recieverPhrase: ADMIN_PHRASE,
            shares: 151,
            packageId: PACKAGE_ID,
            adminCapId: ADMIN_CAP_ID,
        });
        await mintArtworkShard({
            artworkId,
            signerPhrase: ADMIN_PHRASE,
            recieverPhrase: USER1_PHRASE,
            shares: 249,
            packageId: PACKAGE_ID,
            adminCapId: ADMIN_CAP_ID,
        });
        await mintArtworkShard({
            artworkId,
            signerPhrase: ADMIN_PHRASE,
            recieverPhrase: USER2_PHRASE,
            shares: 100,
            packageId: PACKAGE_ID,
            adminCapId: ADMIN_CAP_ID,
        });
    });
    it("can start a voting session", async () => {
        const voteRequest = await createVoteRequest({ artwork_id: artworkId, request: "Request to sell artwork to Museum", packageId: PACKAGE_ID, signerPhrase: ADMIN_PHRASE, adminCapId: ADMIN_CAP_ID });
        assert.ok(voteRequest);
    });
    it("can vote as a shareholder", async () => {
        const voteRequest = await createVoteRequest({ artwork_id: artworkId, request: "Request to sell artwork to Museum", packageId: PACKAGE_ID, signerPhrase: ADMIN_PHRASE, adminCapId: ADMIN_CAP_ID });
        assert.ok(voteRequest);
        const userVote = await vote({ artwork: artworkId, voteRequest, voterAccount: USER1_PHRASE, choice: true });
        assert.ok(userVote);
    });
    it("cannot double vote as a shareholder", async () => {
        const voteRequest = await createVoteRequest({ artwork_id: artworkId, request: "Request to sell artwork to Museum", packageId: PACKAGE_ID, signerPhrase: ADMIN_PHRASE, adminCapId: ADMIN_CAP_ID });
        assert.ok(voteRequest);
        const userVote = await vote({ artwork: artworkId, voteRequest, voterAccount: USER1_PHRASE, choice: true });
        assert.ok(userVote);
        await assert.rejects(vote({ artwork: artworkId, voteRequest, voterAccount: USER1_PHRASE, choice: true }));
    });
    it("cannot vote if not a shareholder", async () => {
        const voteRequest = await createVoteRequest({ artwork_id: artworkId, request: "Request to sell artwork to Museum", packageId: PACKAGE_ID, signerPhrase: ADMIN_PHRASE, adminCapId: ADMIN_CAP_ID });
        assert.ok(voteRequest);
        await assert.rejects(vote({ artwork: artworkId, voteRequest, voterAccount: USER3_PHRASE, choice: true }));
    });
    it("cannot vote if vote is closed", async () => {
        const voteRequest = await createVoteRequest({ artwork_id: artworkId, request: "Request to sell artwork to Museum", packageId: PACKAGE_ID, signerPhrase: ADMIN_PHRASE, adminCapId: ADMIN_CAP_ID });
        assert.ok(voteRequest);
        const userVote = await vote({ artwork: artworkId, voteRequest, voterAccount: USER1_PHRASE, choice: true });
        assert.ok(userVote);
        const endVoteRequest = await endRequestVoting({ voteRequest, packageId: PACKAGE_ID, signerPhrase: ADMIN_PHRASE, adminCapId: ADMIN_CAP_ID });
        assert.ok(endVoteRequest);
        await assert.rejects(vote({ artwork: artworkId, voteRequest, voterAccount: USER1_PHRASE, choice: true }));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFvLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L2Rhby50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUU1QixPQUFPLEVBQVksV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUNMLFlBQVksRUFDWixZQUFZLEVBQ1osVUFBVSxFQUNWLFlBQVksRUFDWixZQUFZLEVBQ1osWUFBWSxHQUNiLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzdELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDbkMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFeEQsTUFBTSxjQUFjLEdBQUc7SUFDckIsWUFBWSxFQUFFLFlBQVk7SUFDMUIsU0FBUyxFQUFFLFVBQVU7SUFDckIsVUFBVSxFQUFFLFlBQVk7SUFDeEIsV0FBVyxFQUFFLEdBQUc7SUFDaEIsVUFBVSxFQUFFLEVBQUU7SUFDZCxVQUFVLEVBQUUsR0FBRztJQUNmLElBQUksRUFBRSxXQUFXO0lBQ2pCLE1BQU0sRUFBRSxtQkFBbUI7SUFDM0IsWUFBWSxFQUFFLGVBQWU7SUFDN0IsV0FBVyxFQUFFLG1CQUFtQjtJQUNoQyxRQUFRLEVBQUUsS0FBaUI7SUFDM0IsS0FBSyxFQUNILDZMQUE2TDtDQUNoTSxDQUFDO0FBRUYsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxJQUFJLFNBQWlCLENBQUM7SUFDdEIsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLFNBQVMsR0FBRyxNQUFNLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM5QyxNQUFNLGdCQUFnQixDQUFD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UyxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUcsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhc3NlcnQgZnJvbSBcImFzc2VydFwiO1xuXG5pbXBvcnQgeyBDdXJyZW5jeSwgbWludEFydHdvcmsgfSBmcm9tIFwiLi4vc3JjL2FydHdvcmtcIjtcbmltcG9ydCB7IG1pbnRBcnR3b3JrU2hhcmQgfSBmcm9tIFwiLi4vc3JjL2FydHdvcmtfc2hhcmRcIjtcbmltcG9ydCB7XG4gIEFETUlOX0NBUF9JRCxcbiAgQURNSU5fUEhSQVNFLFxuICBQQUNLQUdFX0lELFxuICBVU0VSMV9QSFJBU0UsXG4gIFVTRVIyX1BIUkFTRSxcbiAgVVNFUjNfUEhSQVNFLFxufSBmcm9tIFwiLi4vc3JjL2NvbmZpZ1wiO1xuaW1wb3J0IHsgZW5kUmVxdWVzdFZvdGluZyB9IGZyb20gXCIuLi9zcmMvZW5kX3JlcXVlc3Rfdm90aW5nXCI7XG5pbXBvcnQgeyB2b3RlIH0gZnJvbSBcIi4uL3NyYy92b3RlXCI7XG5pbXBvcnQgeyBjcmVhdGVWb3RlUmVxdWVzdCB9IGZyb20gXCIuLi9zcmMvdm90ZV9yZXF1ZXN0XCI7XG5cbmNvbnN0IGFydHdvcmtPcHRpb25zID0ge1xuICBzaWduZXJQaHJhc2U6IEFETUlOX1BIUkFTRSxcbiAgcGFja2FnZUlkOiBQQUNLQUdFX0lELFxuICBhZG1pbkNhcElkOiBBRE1JTl9DQVBfSUQsXG4gIHRvdGFsU3VwcGx5OiA1MDAsXG4gIHNoYXJlUHJpY2U6IDEwLFxuICBtdWx0aXBsaWVyOiAxMDAsXG4gIG5hbWU6IFwiTW9uYSBMaXNhXCIsXG4gIGFydGlzdDogXCJMZW9uYXJkbyBkYSBWaW5jaVwiLFxuICBjcmVhdGlvbkRhdGU6IFwiMTY4NTU0ODY4MDU5NVwiLFxuICBkZXNjcmlwdGlvbjogXCJDaG9jb250YSBwYWludGluZ1wiLFxuICBjdXJyZW5jeTogXCJOT0tcIiBhcyBDdXJyZW5jeSxcbiAgaW1hZ2U6XG4gICAgXCJodHRwczovL3VwbG9hZC53aWtpbWVkaWEub3JnL3dpa2lwZWRpYS9jb21tb25zL3RodW1iL2UvZWMvTW9uYV9MaXNhJTJDX2J5X0xlb25hcmRvX2RhX1ZpbmNpJTJDX2Zyb21fQzJSTUZfcmV0b3VjaGVkLmpwZy84MDBweC1Nb25hX0xpc2ElMkNfYnlfTGVvbmFyZG9fZGFfVmluY2klMkNfZnJvbV9DMlJNRl9yZXRvdWNoZWQuanBnXCIsXG59O1xuXG5kZXNjcmliZShcIkRBTyBWb3Rpbmcgc3RydWN0dXJlXCIsICgpID0+IHtcbiAgbGV0IGFydHdvcmtJZDogc3RyaW5nO1xuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBhcnR3b3JrSWQgPSBhd2FpdCBtaW50QXJ0d29yayhhcnR3b3JrT3B0aW9ucyk7XG4gICAgYXdhaXQgbWludEFydHdvcmtTaGFyZCh7XG4gICAgICBhcnR3b3JrSWQsXG4gICAgICBzaWduZXJQaHJhc2U6IEFETUlOX1BIUkFTRSxcbiAgICAgIHJlY2lldmVyUGhyYXNlOiBBRE1JTl9QSFJBU0UsXG4gICAgICBzaGFyZXM6IDE1MSxcbiAgICAgIHBhY2thZ2VJZDogUEFDS0FHRV9JRCxcbiAgICAgIGFkbWluQ2FwSWQ6IEFETUlOX0NBUF9JRCxcbiAgICB9KTtcbiAgICBhd2FpdCBtaW50QXJ0d29ya1NoYXJkKHtcbiAgICAgIGFydHdvcmtJZCxcbiAgICAgIHNpZ25lclBocmFzZTogQURNSU5fUEhSQVNFLFxuICAgICAgcmVjaWV2ZXJQaHJhc2U6IFVTRVIxX1BIUkFTRSxcbiAgICAgIHNoYXJlczogMjQ5LFxuICAgICAgcGFja2FnZUlkOiBQQUNLQUdFX0lELFxuICAgICAgYWRtaW5DYXBJZDogQURNSU5fQ0FQX0lELFxuICAgIH0pO1xuICAgIGF3YWl0IG1pbnRBcnR3b3JrU2hhcmQoe1xuICAgICAgYXJ0d29ya0lkLFxuICAgICAgc2lnbmVyUGhyYXNlOiBBRE1JTl9QSFJBU0UsXG4gICAgICByZWNpZXZlclBocmFzZTogVVNFUjJfUEhSQVNFLFxuICAgICAgc2hhcmVzOiAxMDAsXG4gICAgICBwYWNrYWdlSWQ6IFBBQ0tBR0VfSUQsXG4gICAgICBhZG1pbkNhcElkOiBBRE1JTl9DQVBfSUQsXG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KFwiY2FuIHN0YXJ0IGEgdm90aW5nIHNlc3Npb25cIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHZvdGVSZXF1ZXN0ID0gYXdhaXQgY3JlYXRlVm90ZVJlcXVlc3QoeyBhcnR3b3JrX2lkOiBhcnR3b3JrSWQsIHJlcXVlc3Q6IFwiUmVxdWVzdCB0byBzZWxsIGFydHdvcmsgdG8gTXVzZXVtXCIsIHBhY2thZ2VJZDogUEFDS0FHRV9JRCwgc2lnbmVyUGhyYXNlOiBBRE1JTl9QSFJBU0UsIGFkbWluQ2FwSWQ6IEFETUlOX0NBUF9JRCB9KTtcbiAgICBhc3NlcnQub2sodm90ZVJlcXVlc3QpO1xuICB9KTtcblxuICBpdChcImNhbiB2b3RlIGFzIGEgc2hhcmVob2xkZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHZvdGVSZXF1ZXN0ID0gYXdhaXQgY3JlYXRlVm90ZVJlcXVlc3QoeyBhcnR3b3JrX2lkOiBhcnR3b3JrSWQsIHJlcXVlc3Q6IFwiUmVxdWVzdCB0byBzZWxsIGFydHdvcmsgdG8gTXVzZXVtXCIsIHBhY2thZ2VJZDogUEFDS0FHRV9JRCwgc2lnbmVyUGhyYXNlOiBBRE1JTl9QSFJBU0UsIGFkbWluQ2FwSWQ6IEFETUlOX0NBUF9JRCB9KTtcbiAgICBhc3NlcnQub2sodm90ZVJlcXVlc3QpO1xuICAgIGNvbnN0IHVzZXJWb3RlID0gYXdhaXQgdm90ZSh7IGFydHdvcms6IGFydHdvcmtJZCwgdm90ZVJlcXVlc3QsIHZvdGVyQWNjb3VudDogVVNFUjFfUEhSQVNFLCBjaG9pY2U6IHRydWUgfSk7XG4gICAgYXNzZXJ0Lm9rKHVzZXJWb3RlKTtcbiAgfSk7XG5cbiAgaXQoXCJjYW5ub3QgZG91YmxlIHZvdGUgYXMgYSBzaGFyZWhvbGRlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgdm90ZVJlcXVlc3QgPSBhd2FpdCBjcmVhdGVWb3RlUmVxdWVzdCh7IGFydHdvcmtfaWQ6IGFydHdvcmtJZCwgcmVxdWVzdDogXCJSZXF1ZXN0IHRvIHNlbGwgYXJ0d29yayB0byBNdXNldW1cIiwgcGFja2FnZUlkOiBQQUNLQUdFX0lELCBzaWduZXJQaHJhc2U6IEFETUlOX1BIUkFTRSwgYWRtaW5DYXBJZDogQURNSU5fQ0FQX0lEIH0pO1xuICAgIGFzc2VydC5vayh2b3RlUmVxdWVzdCk7XG4gICAgY29uc3QgdXNlclZvdGUgPSBhd2FpdCB2b3RlKHsgYXJ0d29yazogYXJ0d29ya0lkLCB2b3RlUmVxdWVzdCwgdm90ZXJBY2NvdW50OiBVU0VSMV9QSFJBU0UsIGNob2ljZTogdHJ1ZSB9KTtcbiAgICBhc3NlcnQub2sodXNlclZvdGUpO1xuICAgIGF3YWl0IGFzc2VydC5yZWplY3RzKHZvdGUoeyBhcnR3b3JrOiBhcnR3b3JrSWQsIHZvdGVSZXF1ZXN0LCB2b3RlckFjY291bnQ6IFVTRVIxX1BIUkFTRSwgY2hvaWNlOiB0cnVlIH0pKTtcbiAgfSk7XG5cbiAgaXQoXCJjYW5ub3Qgdm90ZSBpZiBub3QgYSBzaGFyZWhvbGRlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgdm90ZVJlcXVlc3QgPSBhd2FpdCBjcmVhdGVWb3RlUmVxdWVzdCh7IGFydHdvcmtfaWQ6IGFydHdvcmtJZCwgcmVxdWVzdDogXCJSZXF1ZXN0IHRvIHNlbGwgYXJ0d29yayB0byBNdXNldW1cIiwgcGFja2FnZUlkOiBQQUNLQUdFX0lELCBzaWduZXJQaHJhc2U6IEFETUlOX1BIUkFTRSwgYWRtaW5DYXBJZDogQURNSU5fQ0FQX0lEIH0pO1xuICAgIGFzc2VydC5vayh2b3RlUmVxdWVzdCk7XG4gICAgYXdhaXQgYXNzZXJ0LnJlamVjdHModm90ZSh7IGFydHdvcms6IGFydHdvcmtJZCwgdm90ZVJlcXVlc3QsIHZvdGVyQWNjb3VudDogVVNFUjNfUEhSQVNFLCBjaG9pY2U6IHRydWUgfSkpO1xuICB9KTtcblxuICBpdChcImNhbm5vdCB2b3RlIGlmIHZvdGUgaXMgY2xvc2VkXCIsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB2b3RlUmVxdWVzdCA9IGF3YWl0IGNyZWF0ZVZvdGVSZXF1ZXN0KHsgYXJ0d29ya19pZDogYXJ0d29ya0lkLCByZXF1ZXN0OiBcIlJlcXVlc3QgdG8gc2VsbCBhcnR3b3JrIHRvIE11c2V1bVwiLCBwYWNrYWdlSWQ6IFBBQ0tBR0VfSUQsIHNpZ25lclBocmFzZTogQURNSU5fUEhSQVNFLCBhZG1pbkNhcElkOiBBRE1JTl9DQVBfSUQgfSk7XG4gICAgYXNzZXJ0Lm9rKHZvdGVSZXF1ZXN0KTtcbiAgICBjb25zdCB1c2VyVm90ZSA9IGF3YWl0IHZvdGUoeyBhcnR3b3JrOiBhcnR3b3JrSWQsIHZvdGVSZXF1ZXN0LCB2b3RlckFjY291bnQ6IFVTRVIxX1BIUkFTRSwgY2hvaWNlOiB0cnVlIH0pO1xuICAgIGFzc2VydC5vayh1c2VyVm90ZSk7XG4gICAgY29uc3QgZW5kVm90ZVJlcXVlc3QgPSBhd2FpdCBlbmRSZXF1ZXN0Vm90aW5nKHsgdm90ZVJlcXVlc3QsIHBhY2thZ2VJZDogUEFDS0FHRV9JRCwgc2lnbmVyUGhyYXNlOiBBRE1JTl9QSFJBU0UsIGFkbWluQ2FwSWQ6IEFETUlOX0NBUF9JRCB9KTtcbiAgICBhc3NlcnQub2soZW5kVm90ZVJlcXVlc3QpO1xuICAgIGF3YWl0IGFzc2VydC5yZWplY3RzKHZvdGUoeyBhcnR3b3JrOiBhcnR3b3JrSWQsIHZvdGVSZXF1ZXN0LCB2b3RlckFjY291bnQ6IFVTRVIxX1BIUkFTRSwgY2hvaWNlOiB0cnVlIH0pKTtcbiAgfSk7XG59KTtcbiJdfQ==