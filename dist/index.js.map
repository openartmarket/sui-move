{"version":3,"sources":["../src/endMotion.ts","../src/getters.ts","../src/getContractStocks.ts","../src/mintContract.ts","../src/mintContractStock.ts","../src/mergeContractStock.ts","../src/splitContractStock.ts","../src/transferContractStock.ts","../src/splitTransferMerge.ts","../src/startMotion.ts","../src/sui.ts","../src/toContractStock.ts","../src/vote.ts","../src/Wallet.ts","../src/wallets.ts"],"sourcesContent":["import type { Wallet } from \"./Wallet.js\";\n\nexport type EndMotionParams = {\n  adminCapId: string;\n  motionId: string;\n};\n\nexport type EndMotionResult = {\n  digest: string;\n};\n\nexport async function endMotion(wallet: Wallet, params: EndMotionParams): Promise<EndMotionResult> {\n  const { adminCapId, motionId } = params;\n  const response = await wallet.execute(async (txb, packageId) => {\n    txb.moveCall({\n      target: `${packageId}::dao::end_vote`,\n      arguments: [txb.object(adminCapId), txb.object(motionId)],\n    });\n  });\n  const { digest } = response;\n\n  return { digest };\n}\n","import type {\n  MoveStruct,\n  SuiClient,\n  SuiObjectChangeCreated,\n  SuiObjectData,\n  SuiObjectResponse,\n  SuiParsedData,\n  SuiTransactionBlockResponse,\n} from \"@mysten/sui.js/client\";\n\nimport type { ReadonlyWallet } from \"./Wallet.js\";\n\nexport function getCreatedObjects(txRes: SuiTransactionBlockResponse): SuiObjectChangeCreated[] {\n  return (txRes.objectChanges || []).filter(\n    (change) => change.type === \"created\",\n  ) as SuiObjectChangeCreated[];\n}\n\nexport function getObjectData(response: SuiObjectResponse): SuiObjectData {\n  const { error, data } = response;\n  if (error) {\n    throw error;\n  }\n  if (!data) {\n    throw new Error(`No data: ${JSON.stringify(response)}`);\n  }\n  return data;\n}\n\nexport function getParsedData(data: SuiObjectData): SuiParsedData {\n  const { content } = data;\n  if (!content) {\n    throw new Error(`No content: ${JSON.stringify(data)}`);\n  }\n  return content;\n}\n\nexport function getType(data: SuiParsedData): string {\n  return getMoveObject(data).type;\n}\n\nexport function getStringField(data: SuiParsedData, key: string): string {\n  const { fields } = getMoveObject(data);\n  if (!fields) {\n    throw new Error(`No txn.data.content.fields: ${JSON.stringify(data)}`);\n  }\n\n  function getStringField(struct: MoveStruct, key: string): string {\n    if (Array.isArray(struct)) {\n      throw new Error(`Unexpected response.data.content.fields as array: ${JSON.stringify(data)}`);\n    }\n    if (!(key in struct)) {\n      throw new Error(`No response.data.content.fields[${key}]: ${JSON.stringify(data)}`);\n    }\n    const value = Reflect.get(struct, key);\n    if (typeof value !== \"string\") {\n      throw new Error(\n        `Unexpected type for response.data.content.fields[${key}]: ${JSON.stringify(data)}`,\n      );\n    }\n    return value;\n  }\n\n  return getStringField(fields, key);\n}\n\n/**\n * Get the quantity of a contract or a contract stock.\n */\nexport async function getQuantity(suiClient: SuiClient, id: string): Promise<number> {\n  const response = await suiClient.getObject({\n    id,\n    options: { showContent: true, showOwner: true },\n  });\n  const objectData = getObjectData(response);\n  const parsedData = getParsedData(objectData);\n  return getIntField(parsedData, \"shares\");\n}\n\n/**\n * Get the quantity of a contract or a contract stock.\n */\nexport async function getWalletQuantity(wallet: ReadonlyWallet, id: string): Promise<number> {\n  const { suiClient } = wallet;\n  const response = await suiClient.getObject({\n    id,\n    options: { showContent: true, showOwner: true },\n  });\n  const objectData = getObjectData(response);\n  const addressOwner = getAddressOwner(objectData);\n  if (addressOwner !== wallet.address) {\n    throw new Error(\n      `Object ${objectData} is not owned by ${wallet.address} but by ${addressOwner}`,\n    );\n  }\n\n  const parsedData = getParsedData(objectData);\n  return getIntField(parsedData, \"shares\");\n}\n\nexport function getAddressOwner(objectData: SuiObjectData): string | null {\n  const owner = objectData.owner;\n  if (!owner) throw new Error(`Object ${objectData} has no owner`);\n  if (typeof owner === \"string\") {\n    throw new Error(`Object ${objectData} has a string owner ${owner}`);\n  }\n  if (\"AddressOwner\" in owner) {\n    return owner.AddressOwner;\n  }\n  return null;\n}\n\nfunction getMoveObject(data: SuiParsedData) {\n  const { dataType } = data;\n  if (dataType !== \"moveObject\") {\n    throw new Error(`Unexpected txn.data.content.dataType: ${JSON.stringify(data)}`);\n  }\n  return data;\n}\n\nexport function getIntField(data: SuiParsedData, key: string): number {\n  const value = getStringField(data, key);\n  return toInt(value);\n}\n\nfunction toInt(s: string) {\n  if (!s.match(/^[0-9]+$/)) {\n    throw new Error(`${s} is not a valid integer`);\n  }\n  const number = Number.parseInt(s, 10);\n  if (isNaN(number) || !Number.isInteger(number)) {\n    throw new Error(`${s} is not a valid integer`);\n  }\n  return number;\n}\n","import type { SuiClient, SuiObjectData } from \"@mysten/sui.js/client\";\n\nimport { getObjectData, getParsedData, getStringField, getType } from \"./getters.js\";\n\nexport type GetContractStocksParams = {\n  suiClient: SuiClient;\n  owner: string;\n  contractId: string;\n  packageId: string;\n  cursor?: string;\n};\n\n/**\n * Returns all contract stocks of a contract owned by an address.\n */\nexport async function getContractStocks(\n  params: GetContractStocksParams,\n): Promise<readonly SuiObjectData[]> {\n  const { suiClient, owner, contractId, packageId, cursor } = params;\n  const response = await suiClient.getOwnedObjects({\n    owner,\n    options: {\n      showContent: true,\n    },\n    cursor,\n  });\n  const data = response.data.map(getObjectData).filter((object) => {\n    const parsedData = getParsedData(object);\n    const type = `${packageId}::open_art_market::ContractStock`;\n    return getType(parsedData) === type && getStringField(parsedData, \"contract_id\") === contractId;\n  });\n  if (response.hasNextPage && response.nextCursor) {\n    const nextData = await getContractStocks({\n      ...params,\n      cursor: response.nextCursor,\n    });\n    return [...data, ...nextData];\n  }\n\n  return data;\n}\n","import type {\n  QueryTransactionBlocksParams,\n  SuiClient,\n  SuiTransactionBlockResponse,\n} from \"@mysten/sui.js/dist/cjs/client/index.js\";\nimport type { Wallet } from \"./Wallet.js\";\nimport { getCreatedObjects } from \"./getters.js\";\nimport type { Currency } from \"./types.js\";\n\nexport type MintContractParams = {\n  adminCapId: string;\n  totalShareCount: number;\n  sharePrice: number;\n  outgoingPrice: number;\n  name: string;\n  artist: string;\n  creationTimestampMillis: number;\n  description: string;\n  currency: Currency;\n  productId: string;\n};\n\nexport type MintContractResult = {\n  contractId: string;\n  digest: string;\n};\n\nexport async function mintContract(\n  wallet: Wallet,\n  params: MintContractParams,\n): Promise<MintContractResult> {\n  const {\n    adminCapId,\n    totalShareCount,\n    sharePrice,\n    outgoingPrice,\n    name,\n    artist,\n    creationTimestampMillis,\n    description,\n    currency,\n    productId,\n  } = params;\n\n  const responses = await queryAllTransactions(wallet.suiClient, {\n    filter: {\n      MoveFunction: {\n        function: \"mint_contract\",\n        module: \"open_art_market\",\n        package: wallet.packageId,\n      },\n    },\n    options: {\n      showInput: true,\n      showObjectChanges: true,\n    },\n  });\n\n  const expected = [\n    adminCapId,\n    totalShareCount,\n    sharePrice,\n    outgoingPrice,\n    name,\n    artist,\n    creationTimestampMillis,\n    description,\n    currency,\n    productId,\n  ].map((value) => value.toString());\n\n  let response = responses.find((res) => {\n    if (res.transaction?.data?.transaction?.kind === \"ProgrammableTransaction\") {\n      const inputs = res.transaction.data.transaction.inputs;\n      const inputValues = inputs.map((input) => {\n        if (input.type === \"pure\") {\n          return input.value;\n        }\n        return input.objectId;\n      });\n      return inputValues.every((value, index) => value === expected[index]);\n    }\n    return false;\n  });\n\n  if (!response) {\n    response = await wallet.execute(async (txb, packageId) => {\n      txb.moveCall({\n        target: `${packageId}::open_art_market::mint_contract`,\n        arguments: [\n          txb.object(adminCapId),\n          txb.pure(totalShareCount),\n          txb.pure(sharePrice),\n          txb.pure(outgoingPrice),\n          txb.pure(name),\n          txb.pure(artist),\n          txb.pure(creationTimestampMillis),\n          txb.pure(description),\n          txb.pure(currency),\n          // AKA reference AKA image\n          txb.pure(productId),\n        ],\n      });\n    });\n  }\n\n  const { digest } = response;\n  const objects = getCreatedObjects(response);\n  if (objects.length !== 1) throw new Error(`Expected 1 contract, got ${JSON.stringify(objects)}`);\n  const contractId = objects[0].objectId;\n\n  return { contractId, digest };\n}\n\nasync function queryAllTransactions(client: SuiClient, params: QueryTransactionBlocksParams) {\n  const data: SuiTransactionBlockResponse[] = [];\n  let cursor = undefined;\n  do {\n    const result = await client.queryTransactionBlocks({ ...params, cursor });\n    data.push(...result.data);\n    cursor = result.hasNextPage ? result.nextCursor : null;\n  } while (cursor !== null);\n  return data;\n}\n","import type { Wallet } from \"./Wallet.js\";\nimport { getAddressOwner, getCreatedObjects } from \"./getters.js\";\n\nexport type MintContractStockParams = {\n  adminCapId: string;\n  contractId: string;\n  receiverAddress: string;\n  quantity: number;\n};\n\nexport type MintContractStockResult = {\n  contractStockId: string;\n  digest: string;\n};\n\nexport async function mintContractStock(\n  wallet: Wallet,\n  params: MintContractStockParams,\n): Promise<MintContractStockResult> {\n  const { adminCapId, contractId, quantity, receiverAddress } = params;\n  const response = await wallet.execute(async (txb, packageId) => {\n    txb.moveCall({\n      target: `${packageId}::open_art_market::mint_contract_stock`,\n      arguments: [\n        txb.object(adminCapId),\n        txb.object(contractId),\n        txb.pure(quantity),\n        txb.pure(receiverAddress),\n      ],\n    });\n  });\n  const { digest } = response;\n  const objects = getCreatedObjects(response);\n  const ownedObjects = objects.filter((obj) => getAddressOwner(obj) !== null);\n  if (ownedObjects.length !== 1) {\n    throw new Error(`Expected 1 owned objects, got ${JSON.stringify(ownedObjects, null, 2)}`);\n  }\n  const contractStockId = ownedObjects[0].objectId;\n  return { contractStockId, digest };\n}\n","import type { Wallet } from \"./Wallet.js\";\n\nexport type MergeContractStockParam = {\n  toContractStockId: string;\n  fromContractStockId: string;\n};\n\nexport type MergeContractStockResult = {\n  digest: string;\n};\n\nexport async function mergeContractStock(\n  wallet: Wallet,\n  params: readonly MergeContractStockParam[],\n): Promise<MergeContractStockResult> {\n  const response = await wallet.execute(async (txb, packageId) => {\n    for (const { toContractStockId, fromContractStockId } of params) {\n      txb.moveCall({\n        target: `${packageId}::open_art_market::merge_contract_stocks`,\n        arguments: [txb.object(toContractStockId), txb.object(fromContractStockId)],\n      });\n    }\n  });\n\n  const { digest } = response;\n  return { digest };\n}\n","import type { Wallet } from \"./Wallet.js\";\nimport { getCreatedObjects } from \"./getters.js\";\n\nexport type SplitContractStockParams = {\n  contractStockId: string;\n  quantity: number;\n};\n\nexport type SplitContractStockResult = {\n  digest: string;\n  splitContractStockId: string;\n};\n\nexport async function splitContractStock(\n  wallet: Wallet,\n  params: SplitContractStockParams,\n): Promise<SplitContractStockResult> {\n  const response = await wallet.execute(async (txb, packageId) => {\n    const { contractStockId, quantity } = params;\n    txb.moveCall({\n      target: `${packageId}::open_art_market::split_contract_stock`,\n      arguments: [txb.object(contractStockId), txb.pure(quantity)],\n    });\n  });\n  const { digest } = response;\n\n  const createdObjects = getCreatedObjects(response);\n  if (createdObjects.length !== 1) {\n    throw new Error(`Expected 1 created object, got ${JSON.stringify(createdObjects)}`);\n  }\n  const createdObject = createdObjects[0];\n  const splitContractStockId = createdObject.objectId;\n\n  return { digest, splitContractStockId };\n}\n","import type { Wallet } from \"./Wallet.js\";\n\nexport type TransferContractStockParams = {\n  contractId: string;\n  contractStockId: string;\n  toAddress: string;\n};\n\nexport type TransferContractStockResult = {\n  digest: string;\n};\n\nexport async function transferContractStock(\n  wallet: Wallet,\n  params: TransferContractStockParams,\n): Promise<TransferContractStockResult> {\n  const response = await wallet.execute(async (txb, packageId) => {\n    const { contractId, contractStockId, toAddress } = params;\n    txb.moveCall({\n      target: `${packageId}::open_art_market::transfer_contract_stock`,\n      arguments: [txb.object(contractId), txb.pure(contractStockId), txb.pure(toAddress)],\n    });\n  });\n  const { digest } = response;\n\n  return { digest };\n}\n","import type { SuiObjectData } from \"@mysten/sui.js/client\";\n\nimport type { Wallet } from \"./Wallet.js\";\nimport { getContractStocks } from \"./getContractStocks.js\";\nimport { getWalletQuantity } from \"./getters.js\";\nimport type { MergeContractStockParam } from \"./mergeContractStock.js\";\nimport { mergeContractStock } from \"./mergeContractStock.js\";\nimport { splitContractStock } from \"./splitContractStock.js\";\nimport { transferContractStock } from \"./transferContractStock.js\";\n\nexport type SplitMergeTransferParams = {\n  packageId: string;\n  fromWallet: Wallet;\n  toWallet: Wallet;\n  contractId: string;\n  quantity: number;\n};\n\nexport type SplitMergeTransferResult = {\n  digest: string;\n  fromContractStockId: string;\n  toContractStockId: string;\n};\n\n/**\n * Transfers a quantity of contract stock from one address to another.\n * Takes care of splitting and merging so that aftet the transfer,\n * both addresses have a single stock.\n */\nexport async function splitTransferMerge({\n  packageId,\n  fromWallet,\n  toWallet,\n  contractId,\n  quantity,\n}: SplitMergeTransferParams): Promise<SplitMergeTransferResult> {\n  const fromContractStocks = await getContractStocks({\n    suiClient: fromWallet.suiClient,\n    owner: fromWallet.address,\n    contractId,\n    packageId,\n  });\n  for (const { fromContractStockId, toContractStockId } of makeMergeContractStockParams(\n    fromContractStocks,\n  )) {\n    await mergeContractStock(fromWallet, [{ fromContractStockId, toContractStockId }]);\n  }\n\n  // Check if we need to split the stock\n  const fromContractStocksAfterMerge = await getContractStocks({\n    suiClient: fromWallet.suiClient,\n    owner: fromWallet.address,\n    contractId,\n    packageId,\n  });\n  if (fromContractStocksAfterMerge.length !== 1) {\n    throw new Error(\n      `Expected a single stock after merge, but got ${JSON.stringify(\n        fromContractStocksAfterMerge,\n        null,\n        2,\n      )}`,\n    );\n  }\n\n  const currentQuantity = await getWalletQuantity(\n    fromWallet,\n    fromContractStocksAfterMerge[0].objectId,\n  );\n  if (currentQuantity < quantity) {\n    throw new Error(\n      `Cannot transfer ${quantity} stocks, because there are only ${currentQuantity} stocks`,\n    );\n  }\n  let contractStockId: string;\n  if (currentQuantity > quantity) {\n    const { splitContractStockId } = await splitContractStock(fromWallet, {\n      contractStockId: fromContractStocksAfterMerge[0].objectId,\n      quantity,\n    });\n    contractStockId = splitContractStockId;\n  } else {\n    contractStockId = fromContractStocks[0].objectId;\n  }\n\n  const { digest } = await transferContractStock(fromWallet, {\n    contractId,\n    contractStockId,\n    toAddress: toWallet.address,\n  });\n\n  const toContractStocks = await getContractStocks({\n    suiClient: toWallet.suiClient,\n    owner: toWallet.address,\n    contractId,\n    packageId,\n  });\n  for (const { fromContractStockId, toContractStockId } of makeMergeContractStockParams(\n    toContractStocks,\n  )) {\n    await mergeContractStock(toWallet, [{ fromContractStockId, toContractStockId }]);\n  }\n  return {\n    digest,\n    fromContractStockId: fromContractStocks[0].objectId,\n    toContractStockId: toContractStocks[0].objectId,\n  };\n}\n\nfunction makeMergeContractStockParams(\n  contractStocks: readonly SuiObjectData[],\n): readonly MergeContractStockParam[] {\n  const stocksToMerge = contractStocks.slice(1);\n  return stocksToMerge.map((stock) => ({\n    fromContractStockId: stock.objectId,\n    toContractStockId: contractStocks[0].objectId,\n  }));\n}\n","import type { Wallet } from \"./Wallet.js\";\nimport { getCreatedObjects } from \"./getters.js\";\n\nexport type StartMotionParams = {\n  adminCapId: string;\n  contractId: string;\n  /**\n   * The motion to vote on\n   */\n  motion: string;\n};\n\nexport type StartMotionResult = {\n  digest: string;\n  motionId: string;\n};\n\nexport async function startMotion(\n  wallet: Wallet,\n  params: StartMotionParams,\n): Promise<StartMotionResult> {\n  const { adminCapId, contractId, motion } = params;\n  const response = await wallet.execute(async (txb, packageId) => {\n    txb.moveCall({\n      target: `${packageId}::dao::start_vote`,\n      arguments: [txb.object(adminCapId), txb.pure(contractId), txb.pure(motion)],\n    });\n  });\n  const { digest } = response;\n\n  const createdObjects = getCreatedObjects(response);\n  if (createdObjects.length !== 1) {\n    throw new Error(`Expected 1 created object, got ${JSON.stringify(createdObjects)}`);\n  }\n  const createdObject = createdObjects[0];\n  const motionId = createdObject.objectId;\n\n  return { digest, motionId };\n}\n","import { exec } from \"node:child_process\";\n\ntype Json = string | number | boolean | null | { [key: string]: Json | undefined } | Json[];\n\nasync function getSuiCoinObjectId(): Promise<string> {\n  const gas = await execSui<{ id: { id: string } }[]>(\"sui client gas --json\");\n  return gas[0].id.id;\n}\n\nexport type SuiAddress = {\n  readonly address: string;\n  readonly phrase: string;\n};\n\n/**\n * Creates a new address and transfers balance to it.\n */\nexport async function newSuiAddress(balance = 20_000_000_000): Promise<SuiAddress> {\n  const [address, phrase] = await execSui<[string, string, string]>(\n    \"sui client new-address ed25519 --json\",\n  );\n  const suiCoinObjectId = await getSuiCoinObjectId();\n  await transferSui({ to: address, suiCoinObjectId, amount: balance });\n  return { address, phrase };\n}\n\ntype TransferSuiParams = {\n  to: string;\n  suiCoinObjectId: string;\n  amount: number;\n  gasBudget?: number;\n};\n\nasync function transferSui({\n  to,\n  suiCoinObjectId,\n  amount,\n  gasBudget = 200_000_000,\n}: TransferSuiParams) {\n  await execSui(\n    `sui client transfer-sui --amount ${amount} --to \"${to}\" --gas-budget ${gasBudget} --sui-coin-object-id \"${suiCoinObjectId}\" --json`,\n  );\n}\n\nasync function execSui<T extends Json>(command: string): Promise<T> {\n  return new Promise((resolve, reject) => {\n    exec(command, (err, stdout, stderr) => {\n      if (err) return reject(err);\n      if (stderr) return reject(new Error(stderr));\n      try {\n        resolve(JSON.parse(stdout) as T);\n      } catch {\n        reject(`Didn't get JSON output from sui: ${stdout}`);\n      }\n    });\n  });\n}\n","import type { SuiObjectData } from \"@mysten/sui.js/client\";\n\nimport { getIntField, getParsedData, getStringField } from \"./getters.js\";\n\nexport type ContractStock = {\n  contractStockId: string;\n  digest: string;\n  contractId: string;\n  quantity: number;\n  productId: string;\n};\n\nexport function toContractStock(objectData: SuiObjectData): ContractStock {\n  const parsedData = getParsedData(objectData);\n\n  return {\n    contractStockId: objectData.objectId,\n    digest: objectData.digest,\n    contractId: getStringField(parsedData, \"contract_id\"),\n    quantity: getIntField(parsedData, \"shares\"),\n    productId: getStringField(parsedData, \"reference\"),\n  };\n}\n","import type { Wallet } from \"./Wallet.js\";\n\nexport type VoteParams = {\n  contractId: string;\n  motionId: string;\n  choice: boolean;\n};\n\nexport type VoteResult = {\n  digest: string;\n};\n\nexport async function vote(wallet: Wallet, params: VoteParams): Promise<VoteResult> {\n  const { contractId, motionId, choice } = params;\n  const response = await wallet.execute(async (txb, packageId) => {\n    txb.moveCall({\n      target: `${packageId}::dao::vote`,\n      arguments: [txb.object(contractId), txb.object(motionId), txb.pure(choice)],\n    });\n  });\n  const { digest } = response;\n  return { digest };\n}\n","import type { SuiTransactionBlockResponse } from \"@mysten/sui.js/client\";\nimport { SuiClient, getFullnodeUrl } from \"@mysten/sui.js/client\";\nimport type { Keypair } from \"@mysten/sui.js/cryptography\";\nimport type { TransactionBlock } from \"@mysten/sui.js/transactions\";\nimport { GasStationClient, KeyClient, WalletClient, createSuiClient } from \"@shinami/clients\";\n\nimport type { NetworkName } from \"./types.js\";\nimport { ShinamiWallet, SuiWallet } from \"./wallets.js\";\n\nexport type ReadonlyWallet = {\n  readonly address: string;\n  readonly suiClient: SuiClient;\n  readonly packageId: string;\n};\n\nexport interface Wallet extends ReadonlyWallet {\n  execute(build: BuildTransactionBlock): Promise<SuiTransactionBlockResponse>;\n}\n\nexport type BuildTransactionBlock = (txb: TransactionBlock, packageId: string) => Promise<void>;\n\nexport type NewWalletParams =\n  | NewSuiWalletParams\n  | NewShinamiWalletParams\n  | NewShinamiSponsoredWalletParams;\n\nexport type NewSuiWalletParams = {\n  type: \"sui\";\n  packageId: string;\n  network: NetworkName;\n  keypair: Keypair;\n};\n\nexport type NewShinamiWalletParams = {\n  type: \"shinami\";\n  packageId: string;\n  shinamiAccessKey: string;\n  keypair: Keypair;\n};\n\nexport type NewShinamiSponsoredWalletParams = {\n  type: \"shinami-sponsored\";\n  packageId: string;\n  shinamiAccessKey: string;\n  address: string;\n  walletId: string;\n  secret: string;\n};\n\nexport async function newWallet(params: NewWalletParams): Promise<Wallet> {\n  switch (params.type) {\n    case \"sui\": {\n      const { network, packageId, keypair } = params;\n      const url = getFullnodeUrl(network);\n      const suiClient = new SuiClient({ url });\n      return new SuiWallet({\n        packageId,\n        suiClient,\n        keypair,\n      });\n    }\n    case \"shinami\": {\n      const { packageId, shinamiAccessKey, keypair } = params;\n      const suiClient = createSuiClient(shinamiAccessKey);\n\n      return new SuiWallet({\n        packageId,\n        suiClient,\n        keypair,\n      });\n    }\n    case \"shinami-sponsored\": {\n      const { packageId, shinamiAccessKey, address, walletId, secret } = params;\n      const suiClient = createSuiClient(shinamiAccessKey);\n\n      const gasClient = new GasStationClient(shinamiAccessKey);\n      const keyClient = new KeyClient(shinamiAccessKey);\n      const walletClient = new WalletClient(shinamiAccessKey);\n\n      return new ShinamiWallet({\n        suiClient,\n        gasStationClient: gasClient,\n        keyClient,\n        walletClient,\n        packageId,\n        address,\n        walletId,\n        secret,\n      });\n    }\n  }\n}\n","import { fromB64 } from \"@mysten/bcs\";\nimport type { SuiClient, SuiTransactionBlockResponse } from \"@mysten/sui.js/client\";\nimport type { Keypair } from \"@mysten/sui.js/cryptography\";\nimport { TransactionBlock } from \"@mysten/sui.js/transactions\";\nimport type { GasStationClient, KeyClient, WalletClient } from \"@shinami/clients\";\nimport { ShinamiWalletSigner, buildGaslessTransactionBytes } from \"@shinami/clients\";\n\nimport type { BuildTransactionBlock, Wallet } from \"./Wallet.js\";\n\nexport type SuiWalletParams = {\n  suiClient: SuiClient;\n  packageId: string;\n  keypair: Keypair;\n};\n\nexport class SuiWallet implements Wallet {\n  constructor(private readonly params: SuiWalletParams) {}\n\n  get address(): string {\n    return this.params.keypair.toSuiAddress();\n  }\n\n  get suiClient(): SuiClient {\n    return this.params.suiClient;\n  }\n\n  get packageId(): string {\n    return this.params.packageId;\n  }\n\n  async execute(build: BuildTransactionBlock): Promise<SuiTransactionBlockResponse> {\n    const txb = new TransactionBlock();\n    const { suiClient, packageId, keypair } = this.params;\n    await build(txb, packageId);\n\n    const response = await suiClient.signAndExecuteTransactionBlock({\n      signer: keypair,\n      transactionBlock: txb,\n      requestType: \"WaitForLocalExecution\",\n      options: {\n        showObjectChanges: true,\n        showEffects: true,\n      },\n    });\n\n    return checkResponse(response);\n  }\n}\n\nexport type ShinamiWalletParams = {\n  suiClient: SuiClient;\n  gasStationClient: GasStationClient;\n  walletClient: WalletClient;\n  keyClient: KeyClient;\n  packageId: string;\n  address: string;\n  walletId: string;\n  secret: string;\n};\n\nconst SUI_GAS_FEE_LIMIT = 5_000_000;\n\nexport class ShinamiWallet implements Wallet {\n  constructor(private readonly params: ShinamiWalletParams) {}\n\n  get suiClient(): SuiClient {\n    return this.params.suiClient;\n  }\n\n  get address(): string {\n    return this.params.address;\n  }\n\n  get packageId(): string {\n    return this.params.packageId;\n  }\n\n  async execute(build: BuildTransactionBlock): Promise<SuiTransactionBlockResponse> {\n    const { suiClient, gasStationClient, walletClient, keyClient, packageId, walletId, secret } =\n      this.params;\n\n    const signer = new ShinamiWalletSigner(walletId, walletClient, secret, keyClient);\n\n    const gaslessPayloadBase64 = await buildGaslessTransactionBytes({\n      sui: suiClient,\n      build: (txb) => build(txb, packageId),\n    });\n\n    const sponsoredResponse = await gasStationClient.sponsorTransactionBlock(\n      gaslessPayloadBase64,\n      this.address,\n      SUI_GAS_FEE_LIMIT,\n    );\n    // Sign the sponsored tx.\n    const { signature } = await signer.signTransactionBlock(fromB64(sponsoredResponse.txBytes));\n    const response = await suiClient.executeTransactionBlock({\n      transactionBlock: sponsoredResponse.txBytes,\n      signature: [signature, sponsoredResponse.signature],\n      requestType: \"WaitForLocalExecution\",\n      options: {\n        showObjectChanges: true,\n        showEffects: true,\n      },\n    });\n    return checkResponse(response);\n  }\n}\n\nfunction checkResponse(response: SuiTransactionBlockResponse): SuiTransactionBlockResponse {\n  const { effects } = response;\n  if (!effects) {\n    throw new Error(\"Failed to get execution effects\");\n  }\n  const { status } = effects;\n  if (status.error) {\n    throw new Error(status.error);\n  }\n  if (status.status !== \"success\") {\n    throw new Error(`Transaction failed with status: ${status}`);\n  }\n  return response;\n}\n"],"mappings":"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","names":["getStringField","key"]}